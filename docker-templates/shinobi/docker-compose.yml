version: '3.7'

services:
    shinobi:
        container_name: shinobi
        image: migoller/shinobidocker:microservice-debian
#        network_mode: host
        restart: unless-stopped
        volumes:
            - '/etc/localtime:/etc/localtime:ro'
            - '/etc/timezone:/etc/timezone:ro'
            - "/lochnas/docker-data/shinobi/config:/config"
            - "/lochnas/docker-data/shinobi/videos:/opt/shinobi/videos"
            - "/dev/shm/shinobiDockerTemp:/dev/shm/streams"
#           - $HOME/Shinobi/database:/var/lib/mysql
#           - $HOME/Shinobi/plugins:/home/Shinobi/plugins
        env_file:
            # examples have mysql.env and shinobi.env separate
            - /lochnas/docker-templates/shinobi/.env
        environment:
            # hardcode this HERE so the user doesn't need to in .env
            - MYSQL_HOST=shinobi-db
        networks:
            - backend
        ports:
           - 8080:80
        links:
            - shinobi-db
        depends_on:
            - shinobi-db
    shinobi-db:
        # container name must match MYSQL_HOST
        container_name: shinobi-db
        command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW --innodb_read_only_compressed=OFF
        env_file:
            - /lochnas/docker-templates/shinobi/.env
        volumes:
            - '/etc/localtime:/etc/localtime:ro'
            - '/etc/timezone:/etc/timezone:ro'
            - "/lochnas/docker-data/shinobi/mariadb:/var/lib/mysql"
        restart: unless-stopped
        networks:
            - backend
        image: 'mariadb:10.7'
        #10.8.3 or latest seems to have issues. Lets pin this version
